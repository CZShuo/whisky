{% extends 'base.html' %}
{% load static %}
{% load site_tags %}
{% block title %}Whisky Vitae{% endblock %}
{% block site_name %}{% endblock %}
{% block extra_css %}
    <link rel="stylesheet" href="{% static "css/whisky.css" %}">
{% endblock %}
{% block extra_js %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
    <script src="https://www.chartjs.org/samples/latest/utils.js"></script>
    <script type="text/javascript">
        (function () {                             
            window.generaltableData = JSON.parse('{{general_note_array|safe}}');
            window.personaltableData = JSON.parse('{{personal_note_array|safe}}');
        }());
    </script>
    <script src="{% static "js/whisky.js" %}"></script>
    <script src="{% static "js/whisky_graph.js" %}"></script>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-sm-1 col-xs-1"></div>
        <div class="col-sm-4 col-xs-12"><img class="whisky-img" src="{{ whisky_detail.photo.url }}" /></div>
        <div class="col-sm-6 col-xs-12 whisky-info">
            <div class="whisky-brand">{{ whisky_detail.brand_series }}</div>
            <div class="whisky-name">
                <h2>{{ whisky_detail.name }}</h2>
            </div>
            <div class="whisky-region">
                <img class="country-flag" src="{{ whisky_detail.distillery.country.image.url}}" /> 
                <span>{{ whisky_detail.distillery.region.name }}, {{ whisky_detail.distillery.country.name }}</span>
            </div>
            <hr>
            <div class='tabs'>
                <ul class='nav nav-pills nav-justified'>
                    <li class="tab-li">
                        <a href="#tab-1">Flavor Chart</a>
                    </li>
                    <li class="tab-li">
                        <a href="#tab-2">My Note</a>
                    </li>
                </ul>

                <div class="nav-block" id='tab-1'>
                    <div class="chart">
                        <canvas id="canvas"></canvas>
                    </div>
                </div>

                <div class="nav-block" id='tab-2'>
                    {% if request.user.is_active %}
                    <div class="chart">
                        <input type="hidden" id="personalVar" name="variable">{{ whisky_detail.personal_note }}</input>
                        <canvas id="canvas-individual"></canvas>
                    </div>
                    <div class="button-area">
                        <button id="show-edit-flavor" class="btn">Edit your Flavor</button>
                    </div>
                    <div class="edit-flavor-div" style="display: none; margin-top: 15px">
                        <div id="flavor-bar-controller" style="text-align: center">
                            {% if personal_note %}
                            <span>Flora</span><div class="flavor-ctrl" id="0">{{ personal_note.flora }}</div>
                            <span>Fruity</span><div class="flavor-ctrl" id="1">{{ personal_note.fruity }}</div>
                            <span>Creamy</span><div class="flavor-ctrl" id="2">{{ personal_note.creamy }}</div>
                            <span>Nutty</span><div class="flavor-ctrl" id="3">{{ personal_note.nutty }}</div>
                            <span>Malty</span><div class="flavor-ctrl" id="4">{{ personal_note.malty }}</div>
                            <span>Spicy</span><div class="flavor-ctrl" id="5">{{ personal_note.spicy }}</div>
                            <span>Smoky</span><div class="flavor-ctrl" id="6">{{ personal_note.smoky }}</div>
                            <span>Peaty</span><div class="flavor-ctrl" id="7">{{ personal_note.peaty }}</div>
                            {% else %}
                            <span>Flora</span><div class="flavor-ctrl" id="0">0</div>
                            <span>Fruity</span><div class="flavor-ctrl" id="1">0</div>
                            <span>Creamy</span><div class="flavor-ctrl" id="2">0</div>
                            <span>Nutty</span><div class="flavor-ctrl" id="3">0</div>
                            <span>Malty</span><div class="flavor-ctrl" id="4">0</div>
                            <span>Spicy</span><div class="flavor-ctrl" id="5">0</div>
                            <span>Smoky</span><div class="flavor-ctrl" id="6">0</div>
                            <span>Peaty</span><div class="flavor-ctrl" id="7">0</div>
                            {% endif %}
                        </div>
                    </div>
                    {% else %}
                    <div id="blurred-chart">
                        <input type="hidden" id="personalVar" name="variable"></input>
                        <canvas id="canvas-individual"></canvas>
                    </div>

                    <div id="overflow-cover">
                        <button class="btn if-not-login-btn" style="width: 60%; padding: 10px">
                            PLEASE LOGIN
                        </button>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-sm-1 col-xs-1"></div>
    </div>

    <hr>

    <div class="info-area">
        <div class="row container">
            <div class="col-md-offset-1 col-md-10 col-xs-12">	
                <div style="font-size: 20px; display: inline-block; float: left; margin-top: -5px">Summary</div>
                <div class="buttons" align="right">
                    <button type="button" id="btn-share" data-toggle="popover" data-placement="left" data-container="body">
                        <i class="fas fa-share"></i>
                    </button>
                    <span id="popoverExampleHiddenContent" class="hidden">
                        <div>
                            <a target="_blank" href="#" onclick="window.open(this.href, 'newwindow', 'width=500,height=250'); return false;" class="btn-media twitter">
                                <i class="fab fa-twitter-square sm-icon"></i> 
                                <span class="share-media">Share on Twitter</span>
                            </a>
                        </div>
                        
                        <div style="margin-top:5px">
                            <a target="_blank" href="#" onclick="window.open(this.href, 'newwindow', 'width=500,height=250'); return false;" class="btn-media facebook">
                                <i class="fab fa-facebook sm-icon"></i>
                                <span class="share-media">Share on Facebook</span>
                            </a>
                        </div>
                    </span>
                    {% if request.user.is_active %}
                        {% if bm_boolean == 1 %}
                            <button type="button" id="btn-bm" onclick="wishlistEditor(this, 'bookmark')">
                                <i class="fas fa-bookmark"></i>
                            </button>
                        {% else %}
                            <button type="button" id="btn-bm" onclick="wishlistEditor(this, 'bookmark')">
                                <i class="far fa-bookmark"></i>
                            </button>
                        {% endif %}
                    {% else %}
                        <button type="button" id="btn-bm" class="if-not-login-btn">
                            <img class="bm" src="/static/img/article/bookmark.png">	
                        </button>
                    {% endif %}
                </div>
                <br>
                <div class="whisky-abv">Abv: <span class="info">{{ whisky_detail.abv }}</span></div>
                <div class="whisky-year">Year: <span class="info">{{ whisky_detail.year }}</span></div>
                <div class="whisky-casktype">Casktype: <span class="info">{{ whisky_detail.casktype }}</span></div>
            </div>
        </div>
    </div>

    <div class="comment-area">
        <div class="row container">
            <div class="col-md-offset-1 col-md-10 col-xs-12">		
                <div class="responses-box" id="r">
                    <div class="comments">
                        {% if comments %}
                        <hr style="margin-top: 20px; margin-bottom: 15px">
                        <h3>Reviews</h3>
                            {% for comment in comments %}
                                <div class="row comment-row" style="margin-top: 15px">
                                    <div class="cm-user-pic">
                                        {% if comment.user.profile.profilepic %}
                                            <img src="{{ comment.user.profile.profilepic.url }}" class="img-responsive cm-user-img"/>
                                        {% else %}
                                            <img src="{% static "img/author.png" %}" class="img-responsive cm-user-img" />
                                        {% endif %}
                                    </div>
                                    <div class="cm-user-content" id="cm-user-content-{{ comment.id }}">
                                        <div class="comment-box">
                                            <span class="comment-user">{{ comment.user|show_username }}&nbsp;</span>
                                            <span class="comment-date">{{ comment.created_at }}</span>
                                            <br>
                                            <div class="rating-{{ comment.rating|convert_rate }}" style="margin-bottom: 10px"></div>
                                            <div class="comment-content-31">{{ comment.note }}</div>
                                        </div>

                                        {% if request.user == comment.user %}
                                        <div class="popover-container">
                                            <div class="comment-control-sec">
                                                <button type="button" class="btn-control" id="btn-control" data-popover="true" data-placement="bottom" data-container="body">
                                                    <i class="fas fa-ellipsis-h"></i>
                                                </button>
                                                <div id="popover-content" class="hidden">
                                                    <button type="button" name="edit-comment" class="comment-control" onclick = "editComment({{ comment.id }})">
                                                        <i class="fa fa-edit fa-fw btn-ctrl"></i>Edit...
                                                    </button>
                                                    <button type="button" name="delete-comment" class="comment-control" onclick = "deleteComment({{ comment.id }})">
                                                        <i class="fa fa-trash fa-fw btn-ctrl"></i>Delete...
                                                    </button>                                                    
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>

                                    {% if request.user == comment.user %}
                                    <div id="edit-box-{{ comment.id }}" style="display: none">
                                        <form method="post">
                                            {% csrf_token %} 
                                            {% if request.user.is_active %}
                                            <input type="hidden" id="comment-id" name="comment-id" value="{{ comment.id }}">
                                            <div class="rating-edit-{{ comment.rating|convert_rate }}" id="rating-edit-{{ comment.id }}" style="margin-top: 10px"></div>
                                            <textarea required class="form-control comment" placeholder="This whisky is..." name="comment-edit" id="comment-edit">{{ comment.note }}</textarea>
                                            <input type="checkbox" name="publish_choice" id="publish_choice" value="Private">Private Note</input>
                                            <br>
                                            <button type="reset" id="cancel" name="cancel" class="btn btn-default" value="1" style="margin-top: 10px" onclick="cancelEdit({{ comment.id }},{{ comment.rating }})">Cancel</button>
                                            <input type="submit" value="submit" class ="btn" style="color:#333; margin-top: 10px">
                                            {% else %}
                                            <textarea class="form-control comment" placeholder="Please login or signup" disabled></textarea>
                                            {% endif %}
                                        </form>	
                                    </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        {% endif %}
                        <hr style="margin-top: 20px; margin-bottom: 15px">
                    </div>
                    <h3>My Notes</h3>
                    <form method="post">
                        {% csrf_token %} 
                        {% if request.user.is_active %}
                        <div class="my-rating" style="margin-bottom: 10px"></div>
                        <input type="hidden" id="myRating" name="myRating" value="" />
                        <textarea required class="form-control comment" placeholder="This whisky is..." name="comment" id="comment"></textarea>
                        <input type="checkbox" name="publish_choice" id="publish_choice" value="Private">Private Note</input>
                        <br>
                        <input type="submit" value="submit" class ="btn" style="color:#333; margin-top: 10px">
                        {% else %}
                        <textarea class="form-control comment" placeholder="Please login or signup" disabled></textarea>
                        {% endif %}
                    </form>					
                </div>
            </div>
        </div>
    </div>
    
    
{% endblock %}